{"version":3,"file":"static/js/830.25291886.chunk.js","mappings":"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","sources":["../../src/record.js","../../src/realtime.js","../../src/xfyun-dist/index.esm.js","../../src/realtime-xfyun.js"],"sourcesContent":["import axios from 'axios';\nimport Recorder from 'recorder-core';\nimport 'recorder-core/recorder.wav.min';\n\nconst record = async options => {\n  const {\n    url,\n    sampleRate,\n    bitRate,\n    options: requestOptions,\n    onComplete\n  } = Object.assign(\n    {\n      sampleRate: 16000,\n      bitRate: 16\n    },\n    {},\n    options\n  );\n  const rec = Recorder({\n    type: 'wav',\n    sampleRate,\n    bitRate\n  });\n  return {\n    start: async () => {\n      await new Promise((resolve, reject) => {\n        rec.open(resolve, reject);\n      });\n      rec.start();\n      return { record: rec };\n    },\n    stop: async () => {\n      const file = await new Promise((resolve, reject) => {\n        rec.stop(blob => {\n          resolve(new File([blob], 'audio.wav', { type: 'audio/wav' }));\n        }, reject);\n      });\n      rec.close();\n      onComplete && onComplete({ file });\n      return url && (await axios.postForm(url, { file }, requestOptions));\n    }\n  };\n};\n\nexport default record;\n","import axios from 'axios';\nimport { v4 as uuidv4 } from 'uuid';\n\nconst getUUId = () => {\n  return uuidv4().replace(/-/g, '');\n};\n\nconst realtime = async options => {\n  const {\n    url,\n    options: requestOptions,\n    getToken,\n    getGatewayUrl,\n    sampleRate,\n    onError,\n    onChange,\n    onComplete\n  } = Object.assign(\n    {},\n    {\n      getGatewayUrl: ({ token }) => `wss://nls-gateway-cn-shanghai.aliyuncs.com/ws/v1?token=${token}`,\n      onChange: ({ message }) => {\n        console.log(message);\n      },\n      onError: () => {},\n      sampleRate: 16000\n    },\n    options\n  );\n  const taskId = getUUId();\n  let context = null;\n  return {\n    start: async () => {\n      const { token, appKey } = await getToken();\n      const messageId = getUUId();\n      const ws = new WebSocket(getGatewayUrl({ token }));\n      const resultChunks = [];\n      const chunks = [];\n      let message = '';\n      await new Promise(resolve => {\n        ws.addEventListener('open', () => {\n          console.log('socket链接成功');\n          ws.send(\n            JSON.stringify({\n              header: {\n                message_id: messageId,\n                task_id: taskId,\n                namespace: 'SpeechTranscriber',\n                name: 'StartTranscription',\n                appkey: appKey\n              },\n              payload: {\n                format: 'pcm',\n                sample_rate: 16000,\n                max_sentence_silence: 200,\n                enable_intermediate_result: true,\n                enable_punctuation_prediction: true,\n                enable_inverse_text_normalization: true\n              }\n            })\n          );\n        });\n        ws.addEventListener('message', e => {\n          const data = JSON.parse(e.data);\n          if (data.header.name === 'TranscriptionStarted') {\n            resolve();\n          }\n          if (data.header.name === 'TranscriptionResultChanged' || data.header.name === 'SentenceEnd') {\n            Object.assign(resultChunks, { [data.payload.index]: data.payload.result });\n            message = Object.keys(resultChunks)\n              .sort((a, b) => a - b)\n              .map(index => resultChunks[index])\n              .join('');\n            onChange &&\n              onChange({\n                payload: data.payload,\n                chunks: resultChunks,\n                message\n              });\n          }\n        });\n      });\n      const stream = await window.navigator.mediaDevices.getUserMedia({ audio: true }).catch(e => {\n        console.log('获取麦克风权限失败，请刷新后重试');\n        onError('获取麦克风权限失败，请刷新后重试', 'NO_MICROPHONE_PERMISSION', e);\n        throw e;\n      });\n      const recorder = new window.MediaRecorder(stream);\n      recorder.start(1000);\n\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)({\n        sampleRate\n      });\n      const audioInput = audioContext.createMediaStreamSource(stream);\n      const scriptProcessor = audioContext.createScriptProcessor(2048, 1, 1);\n      scriptProcessor.onaudioprocess = function (event) {\n        const inputData = event.inputBuffer.getChannelData(0);\n        const inputData16 = new Int16Array(inputData.length);\n        for (let i = 0; i < inputData.length; ++i) {\n          inputData16[i] = Math.max(-1, Math.min(1, inputData[i])) * 0x7fff; // PCM 16-bit\n        }\n        ws.send(inputData16.buffer);\n      };\n      audioInput.connect(scriptProcessor);\n      scriptProcessor.connect(audioContext.destination);\n      const dataHandler = e => {\n        chunks.push(e.data);\n      };\n      recorder.addEventListener('dataavailable', dataHandler);\n      context = {\n        ws,\n        stream,\n        taskId,\n        messageId,\n        scriptProcessor,\n        audioInput,\n        audioContext,\n        appKey,\n        resultChunks,\n        chunks,\n        message,\n        destroy: () => {\n          ws.send(\n            JSON.stringify({\n              header: {\n                message_id: messageId,\n                task_id: taskId,\n                namespace: 'SpeechTranscriber',\n                name: 'StopTranscription',\n                appkey: appKey\n              }\n            })\n          );\n          recorder.removeEventListener('dataavailable', dataHandler);\n          ws.close();\n          scriptProcessor.disconnect();\n          audioInput.disconnect();\n          audioContext.close();\n          const tracks = (stream.getTracks && stream.getTracks()) || stream.audioTracks || [];\n          tracks.forEach(track => {\n            track.stop && track.stop();\n          });\n          stream.stop && stream.stop();\n        }\n      };\n      return context;\n    },\n    stop: async () => {\n      if (!context) {\n        return;\n      }\n      const { taskId, messageId, chunks, destroy, message } = context;\n      const file = await new Promise((resolve, reject) => {\n        const file = new File(chunks, `${taskId}.wav`, { type: 'audio/wav' });\n        onComplete && onComplete({ file, taskId, messageId, message, chunks });\n        destroy();\n        context = null;\n        resolve(file);\n      });\n      return url && (await axios.postForm(url, { file }, requestOptions));\n    }\n  };\n};\n\nexport default realtime;\n","function e(e, t, r, o) {\n  return new (r || (r = Promise))(function (n, a) {\n    function i(e) {\n      try {\n        s(o.next(e));\n      } catch (e) {\n        a(e);\n      }\n    }\n    function u(e) {\n      try {\n        s(o.throw(e));\n      } catch (e) {\n        a(e);\n      }\n    }\n    function s(e) {\n      var t;\n      e.done\n        ? n(e.value)\n        : ((t = e.value),\n          t instanceof r\n            ? t\n            : new r(function (e) {\n                e(t);\n              })).then(i, u);\n    }\n    s((o = o.apply(e, t || [])).next());\n  });\n}\nfunction t(e, t) {\n  var r,\n    o,\n    n,\n    a,\n    i = {\n      label: 0,\n      sent: function () {\n        if (1 & n[0]) throw n[1];\n        return n[1];\n      },\n      trys: [],\n      ops: []\n    };\n  return (\n    (a = { next: u(0), throw: u(1), return: u(2) }),\n    'function' == typeof Symbol &&\n      (a[Symbol.iterator] = function () {\n        return this;\n      }),\n    a\n  );\n  function u(u) {\n    return function (s) {\n      return (function (u) {\n        if (r) throw new TypeError('Generator is already executing.');\n        for (; a && ((a = 0), u[0] && (i = 0)), i; )\n          try {\n            if (((r = 1), o && (n = 2 & u[0] ? o.return : u[0] ? o.throw || ((n = o.return) && n.call(o), 0) : o.next) && !(n = n.call(o, u[1])).done)) return n;\n            switch (((o = 0), n && (u = [2 & u[0], n.value]), u[0])) {\n              case 0:\n              case 1:\n                n = u;\n                break;\n              case 4:\n                return i.label++, { value: u[1], done: !1 };\n              case 5:\n                i.label++, (o = u[1]), (u = [0]);\n                continue;\n              case 7:\n                (u = i.ops.pop()), i.trys.pop();\n                continue;\n              default:\n                if (!((n = i.trys), (n = n.length > 0 && n[n.length - 1]) || (6 !== u[0] && 2 !== u[0]))) {\n                  i = 0;\n                  continue;\n                }\n                if (3 === u[0] && (!n || (u[1] > n[0] && u[1] < n[3]))) {\n                  i.label = u[1];\n                  break;\n                }\n                if (6 === u[0] && i.label < n[1]) {\n                  (i.label = n[1]), (n = u);\n                  break;\n                }\n                if (n && i.label < n[2]) {\n                  (i.label = n[2]), i.ops.push(u);\n                  break;\n                }\n                n[2] && i.ops.pop(), i.trys.pop();\n                continue;\n            }\n            u = t.call(e, i);\n          } catch (e) {\n            (u = [6, e]), (o = 0);\n          } finally {\n            r = n = 0;\n          }\n        if (5 & u[0]) throw u[1];\n        return { value: u[0] ? u[1] : void 0, done: !0 };\n      })([u, s]);\n    };\n  }\n}\nvar r = !AudioWorkletNode;\nfunction o() {\n  var e;\n  return (null === (e = navigator.mediaDevices) || void 0 === e ? void 0 : e.getUserMedia)\n    ? navigator.mediaDevices.getUserMedia({ audio: !0, video: !1 })\n    : navigator.getUserMedia\n      ? new Promise(function (e, t) {\n          navigator.getUserMedia(\n            { audio: !0, video: !1 },\n            function (t) {\n              e(t);\n            },\n            function (e) {\n              t(e);\n            }\n          );\n        })\n      : Promise.reject(new Error('不支持录音'));\n}\nfunction n(o, n) {\n  return e(this, void 0, void 0, function () {\n    return t(this, function (e) {\n      switch (e.label) {\n        case 0:\n          return r ? [4, o.audioWorklet.addModule(''.concat(n, '/processor.worklet.js'))] : [3, 2];\n        case 1:\n          return e.sent(), [2, new AudioWorkletNode(o, 'processor-worklet')];\n        case 2:\n          return [4, new Worker(''.concat(n, '/processor.worker.js'))];\n        case 3:\n          return [2, { port: e.sent() }];\n      }\n    });\n  });\n}\nvar a = (function () {\n  function a(e) {\n    (this.processorPath = e), (this.audioBuffers = []);\n  }\n  return (\n    (a.prototype.start = function (a) {\n      var i,\n        u = a.sampleRate,\n        s = a.frameSize,\n        c = a.arrayBufferType;\n      return e(this, void 0, void 0, function () {\n        var e, a, d, l, f, p;\n        return t(this, function (t) {\n          switch (t.label) {\n            case 0:\n              return ((e = this).audioBuffers = []), [4, o()];\n            case 1:\n              return (\n                (a = t.sent()),\n                (this.audioTracks = a.getAudioTracks()),\n                (d = (function (e, t) {\n                  var r;\n                  try {\n                    (r = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: t })).createMediaStreamSource(e);\n                  } catch (t) {\n                    (r = new (window.AudioContext || window.webkitAudioContext)()).createMediaStreamSource(e);\n                  }\n                  return r;\n                })(a, u)),\n                (this.audioContext = d),\n                d.createMediaStreamSource(a),\n                (l = d.createMediaStreamSource(a)),\n                [4, n(d, this.processorPath)]\n              );\n            case 2:\n              return (\n                (f = t.sent()),\n                (this.audioWorklet = f),\n                f.port.postMessage({ type: 'init', data: { frameSize: s, toSampleRate: u || d.sampleRate, fromSampleRate: d.sampleRate, arrayBufferType: c || 'short16' } }),\n                (f.port.onmessage = function (t) {\n                  s && e.onFrameRecorded && e.onFrameRecorded(t.data),\n                    e.onStop && (t.data.frameBuffer && e.audioBuffers.push(t.data.frameBuffer), t.data.isLastFrame && !r && (null == f ? void 0 : f.port).terminate(), t.data.isLastFrame && e.onStop(e.audioBuffers));\n                }),\n                r\n                  ? l.connect(f)\n                  : (((p = d.createScriptProcessor(0, 1, 1)).onaudioprocess = function (e) {\n                      f.port.postMessage({ type: 'message', data: e.inputBuffer.getChannelData(0) });\n                    }),\n                    l.connect(p),\n                    p.connect(d.destination)),\n                d.resume(),\n                null === (i = this.onStart) || void 0 === i || i.call(this),\n                [2]\n              );\n          }\n        });\n      });\n    }),\n    (a.prototype.stop = function () {\n      var e, t, r;\n      null === (e = this.audioWorklet) || void 0 === e || e.port.postMessage({ type: 'stop' }), null === (t = this.audioTracks) || void 0 === t || t[0].stop(), null === (r = this.audioContext) || void 0 === r || r.suspend();\n    }),\n    a\n  );\n})();\nexport { a as default };\n","import RecorderManager from './xfyun-dist/index.esm';\n\nconst realtime = async options => {\n  const {\n    url,\n    workerUrl,\n    options: requestOptions,\n    getToken,\n    getGatewayUrl,\n    onError,\n    onChange,\n    onProgress,\n    onComplete,\n    sampleRate,\n    frameSize\n  } = Object.assign(\n    {},\n    {\n      getGatewayUrl: params => {\n        const urlSearchParams = new URLSearchParams(params);\n        return `wss://rtasr.xfyun.cn/v1/ws?${urlSearchParams.toString()}`;\n      },\n      onChange: ({ message }) => {\n        console.log(message);\n      },\n      onProgress: () => {},\n      onError: () => {},\n      sampleRate: 16000,\n      frameSize: 1280\n    },\n    options\n  );\n\n  let context = null;\n  return {\n    start: async options => {\n      const recorder = new RecorderManager(workerUrl);\n      const recorderPromise = new Promise(resolve => {\n        recorder.onStart = () => {\n          resolve();\n        };\n      });\n      const params = Object.assign({}, options, await getToken());\n      const url = getGatewayUrl(params);\n      const ws = new WebSocket(url);\n      let resultText = '',\n        resultArray = [],\n        type = '0';\n      ws.onopen = e => {\n        // 开始录音\n        recorder.start({\n          sampleRate,\n          frameSize\n        });\n      };\n      ws.onerror = e => {\n        console.error(e);\n        recorder.stop();\n        onError('连接服务器失败', 'WS_SERVER_ERROR', e);\n      };\n      ws.onclose = () => {\n        recorder.stop();\n      };\n      ws.onmessage = e => {\n        let jsonData = JSON.parse(e.data);\n\n        console.log(jsonData);\n        if (jsonData.action === 'error') {\n          console.log(jsonData);\n          onError(jsonData.desc, 'XFYUN_SERVER_ERROR', jsonData);\n        }\n\n        if (jsonData.action !== 'result') {\n          return;\n        }\n        const data = JSON.parse(jsonData.data);\n        let resultTextTemp = '';\n        data.cn.st.rt.forEach(j => {\n          j.ws.forEach(k => {\n            k.cw.forEach(l => {\n              if (l.rl !== '0') {\n                type = l.rl;\n              }\n              resultTextTemp += l.w;\n            });\n          });\n        });\n        if (data.cn.st.type === '0') {\n          const time = new Date();\n          // 【最终】识别结果：\n          resultText += resultTextTemp;\n          if (type !== '0') {\n            if (!Array.isArray(resultArray[type - 1])) {\n              resultArray[type - 1] = [];\n            }\n            resultArray[type - 1].push({\n              type,\n              message: resultTextTemp,\n              time\n            });\n          }\n          onProgress && onProgress({ type, message: resultTextTemp, time });\n          resultTextTemp = '';\n        }\n        onChange && onChange({ message: resultText, messageList: resultArray, temp: resultTextTemp, type });\n      };\n\n      recorder.onFrameRecorded = ({ isLastFrame, frameBuffer }) => {\n        if (ws.readyState === ws.OPEN) {\n          ws.send(new Int8Array(frameBuffer));\n          if (isLastFrame) {\n            ws.send('{\"end\": true}');\n          }\n        }\n      };\n\n      recorder.onStop = audioBuffers => {\n        onComplete && onComplete({ audioBuffers });\n      };\n      context = { ws, recorder, params };\n      await recorderPromise;\n      return context;\n    },\n    stop: async () => {\n      if (!context) {\n        return;\n      }\n      const { recorder } = context;\n      recorder.stop();\n    }\n  };\n};\n\nexport default realtime;\n"],"names":["record","async","url","sampleRate","bitRate","options","requestOptions","onComplete","Object","assign","rec","Recorder","type","start","Promise","resolve","reject","open","stop","file","blob","File","close","axios","getUUId","v4","replace","realtime$1","getToken","getGatewayUrl","onError","onChange","_ref","token","_ref2","message","console","log","taskId","context","appKey","messageId","ws","WebSocket","resultChunks","chunks","addEventListener","send","JSON","stringify","header","message_id","task_id","namespace","name","appkey","payload","format","sample_rate","max_sentence_silence","enable_intermediate_result","enable_punctuation_prediction","enable_inverse_text_normalization","e","data","parse","index","result","keys","sort","a","b","map","join","stream","window","navigator","mediaDevices","getUserMedia","audio","catch","recorder","MediaRecorder","audioContext","AudioContext","webkitAudioContext","audioInput","createMediaStreamSource","scriptProcessor","createScriptProcessor","onaudioprocess","event","inputData","inputBuffer","getChannelData","inputData16","Int16Array","length","i","Math","max","min","buffer","connect","destination","dataHandler","push","destroy","removeEventListener","disconnect","getTracks","audioTracks","forEach","track","t","r","o","n","s","next","u","throw","done","value","then","apply","label","sent","trys","ops","return","Symbol","iterator","this","TypeError","call","pop","AudioWorkletNode","video","Error","audioWorklet","addModule","concat","Worker","port","processorPath","audioBuffers","prototype","frameSize","c","arrayBufferType","d","l","f","p","getAudioTracks","postMessage","toSampleRate","fromSampleRate","onmessage","onFrameRecorded","onStop","frameBuffer","isLastFrame","terminate","resume","onStart","suspend","realtime","workerUrl","onProgress","params","URLSearchParams","toString","_ref3","recorderPromise","resultText","resultArray","onopen","onerror","error","onclose","jsonData","action","desc","resultTextTemp","cn","st","rt","j","k","cw","rl","w","time","Date","Array","isArray","messageList","temp","_ref4","readyState","OPEN","Int8Array"],"sourceRoot":""}